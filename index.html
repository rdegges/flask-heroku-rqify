<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>flask-heroku-rqify by rdegges</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <script src="javascripts/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1 class="header">flask-heroku-rqify</h1>
        <p class="header">Automatic RQ configuration for your Heroku Flask applications.</p>

        <ul>
          <li class="download"><a class="buttons" href="https://github.com/rdegges/flask-heroku-rqify/zipball/master">Download ZIP</a></li>
          <li class="download"><a class="buttons" href="https://github.com/rdegges/flask-heroku-rqify/tarball/master">Download TAR</a></li>
          <li><a class="buttons github" href="https://github.com/rdegges/flask-heroku-rqify">View On GitHub</a></li>
        </ul>

        <p class="header">This project is maintained by <a class="header name" href="https://github.com/rdegges">rdegges</a></p>


      </header>
      <section>
        <h1>flask-heroku-rqify</h1>

<p>Automatic RQ configuration for your Heroku Flask applications.</p>

<p><img src="https://raw.github.com/rdegges/flask-heroku-rqify/master/assets/worker-sketch.jpg" alt="Worker Sketch"></p>

<h2>Purpose</h2>

<p><a href="http://python-rq.org/">RQ</a> is a lightweight, simple, and efficient Python
library for queueing jobs and processing them in the background with workers.
It uses <a href="http://redis.io/">Redis</a> as a back end.</p>

<p><code>flask-heroku-rqify</code> handles all RQ configuration for you, so that you can get
your application processing asynchronous tasks with only a single line of code!</p>

<p>In addition to make configuration easier, <code>flask-heroku-rqify</code> also allows you
to seamlessly switch your Heroku Redis provider instantly, with no downtime.  By
analyzing which Redis addons your Heroku application has available, and
automatically configuring RQ to use these addons, you can easily swap your Redis
providers around without touching a single line of code!</p>

<h2>Install</h2>

<p>To install <code>flask-heroku-rqify</code>, use <a href="http://pip.readthedocs.org/en/latest/">pip</a>.</p>

<div class="highlight"><pre><span class="nv">$ </span>pip install flask-heroku-rqify
</pre></div>

<p>Next, modify your <code>requirements.txt</code> file in your home directory, and add the
following to the bottom of your file:</p>

<div class="highlight"><pre>Flask-Heroku-RQify&gt;<span class="o">=</span>0.1
</pre></div>

<h2>Pick an Addon</h2>

<p>Heroku has lots of available Redis addons.  <code>flask-heroku-rqify</code> works with
them all!  That means no matter which option you choose, your queue will work
out of the box, guaranteed!</p>

<p>Below is a list of the addons you can install to get started, you should have at
least one of these activated on your Heroku app -- otherwise,
<code>flask-heroku-rqify</code> will attempt to connect to your default Redis instance
running locally (good for local development).</p>

<ul>
<li><a href="https://addons.heroku.com/redisgreen">RedisGreen</a></li>
<li><a href="https://addons.heroku.com/myredis">MyRedis</a></li>
<li><a href="https://addons.heroku.com/rediscloud">Redis Cloud</a></li>
<li><a href="https://addons.heroku.com/redistogo">Redis To Go</a></li>
<li><a href="https://addons.heroku.com/openredis">openredis</a></li>
</ul><p><strong>NOTE</strong>: My favorite providers are openredis and RedisGreen.</p>

<h2>Usage</h2>

<p>Using <code>flask-heroku-rqify</code> is <em>super easy</em>!  In your <code>app.py</code> (or wherever
you define your Flask application), add the following:</p>

<div class="highlight"><pre><span class="kn">from</span> <span class="nn">flask.ext.rqify</span> <span class="kn">import</span> <span class="n">init_rqify</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>
<span class="n">init_rqify</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
</pre></div>

<p>To define tasks, you can do the following:</p>

<div class="highlight"><pre><span class="kn">from</span> <span class="nn">flask.ext.rq</span> <span class="kn">import</span> <span class="n">job</span>

<span class="nd">@job</span>
<span class="k">def</span> <span class="nf">process</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
    <span class="c"># process stuff...</span>
</pre></div>

<p>To use the task defined above, you could do:</p>

<div class="highlight"><pre><span class="o">&gt;&gt;&gt;</span> <span class="n">process</span><span class="o">.</span><span class="n">delay</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</pre></div>

<p>Once you've defined your tasks, it's now time to boot up a worker process!  To
do this, we'll use the
<a href="http://flask-script.readthedocs.org/en/latest/">Flask-Script</a> extension (which
is installed automatically by <code>flask-heroku-rqify</code>).  In your project directory,
create a new file named <code>manage.py</code>, and add the following:</p>

<div class="highlight"><pre><span class="kn">from</span> <span class="nn">flask.ext.rq</span> <span class="kn">import</span> <span class="n">get_worker</span>
<span class="kn">from</span> <span class="nn">flask.ext.script</span> <span class="kn">import</span> <span class="n">Manager</span>

<span class="kn">from</span> <span class="nn">myapp</span> <span class="kn">import</span> <span class="n">app</span>


<span class="n">manager</span> <span class="o">=</span> <span class="n">Manager</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>


<span class="nd">@manager.command</span>
<span class="k">def</span> <span class="nf">work</span><span class="p">():</span>
    <span class="sd">"""Process the queue."""</span>
    <span class="n">get_worker</span><span class="p">()</span><span class="o">.</span><span class="n">work</span><span class="p">()</span>


<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>
    <span class="n">manager</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>

<p>Then modify your <code>Procfile</code>, and add the following line:</p>

<pre><code>worker: python manage.py work
</code></pre>

<p>Now, to start processing your tasks on your new worker, you can finally just
spin up a new worker process using <code>heroku scale</code>:</p>

<div class="highlight"><pre><span class="nv">$ </span>heroku scale <span class="nv">worker</span><span class="o">=</span>1
</pre></div>

<p>If you'd like to process your queue faster, you can add more workers at any
time:</p>

<div class="highlight"><pre><span class="nv">$ </span>heroku scale <span class="nv">worker</span><span class="o">=</span>10
</pre></div>

<p>How does this work?  In the background, <code>flask-heroku-rqify</code> is really just
automatically configuring the popular
<a href="https://flask-rq.readthedocs.org/en/latest/">Flask-RQ</a> extension!  This means,
you can basically read through the <a href="https://flask-rq.readthedocs.org/en/latest/">official
documentation</a> to learn more about
RQ, how it works, and how Flask-RQ works.</p>

<h2>Like This?</h2>

<p>Like this software?  If you really enjoy <code>flask-heroku-rqify</code>, you can show
your appreciation by:</p>

<ul>
<li>Sending me some bitcoin, my address is: <strong>166UZk46Y6sLBj2br1whB9mvzxQD2EVfUp</strong>
</li>
<li>Tipping me on <a href="https://www.gittip.com/rdegges/">gittip</a>.</li>
</ul><p>Either way, thanks!  &lt;3</p>

<h2>Changelog</h2>

<p>v0.1: 04-21-2013</p>

<pre><code>- Pushing first release to PyPI!
- Adding `init_rqify` handler to auto-configure Flask-RQ.
</code></pre>
      </section>
      <footer>
        <p><small>Hosted on <a href="https://pages.github.com">GitHub Pages</a> using the Dinky theme</small></p>
      </footer>
    </div>
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->
		
  </body>
</html>